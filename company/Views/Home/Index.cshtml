@model company.Controllers.IndexViewModel
@*@model company.Models.CompanyViewModel*@
@{
    ViewData["Title"] = "بيانات الشركة";
}

<style>
    body {
        font-family: Tahoma, Arial, sans-serif;
        background-color: #f9f9f9;
    }

    .form-container {
        @* max-width: 800px; *@
        margin: auto;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    h2 {
        text-align: center;
        color: #4361ee;
    }

    .form-group label {
        font-weight: bold;
    }

    .btn-submit {
        background-color: #4361ee;
        color: white;
    }

        .btn-submit:hover {
            background-color: #3a0ca3;
        }
         input[type="checkbox"].icon-checkbox {
    -webkit-appearance: none;
       -moz-appearance: none;
            appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid #ccc;
    border-radius: 4px;
    position: relative;
    cursor: default;
    vertical-align: middle;
    margin: 0;
  }

  /* ✖ عند غير المؤشر */
  input[type="checkbox"].icon-checkbox::after {
    content: "✖";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 14px;
    color: red;
  }

  /* ✔ عند المؤشر */
  input[type="checkbox"].icon-checkbox:checked::after {
    content: "✔";
    color: green;
  }
</style>

<div class="container form-container">
    <h2>بيانات الشركة</h2>
    <form id="companyForm" asp-action="SaveCompany" method="post">
        @Html.AntiForgeryToken()
        <div class="row">
            <div class="col-md-6">
                <div class="form-group mb-3">
                    <label asp-for="NewCompany.ComArabicName"  class="form-label">الاسم العربي</label>
                    <input asp-for="NewCompany.ComArabicName" id="ComArabicName" class="form-control" required />
                </div>
                <div class="form-group mb-3">
                    <label asp-for="NewCompany.ShortArabicName" class="form-label">الاسم المختصر عربي</label>
                    <input asp-for="NewCompany.ShortArabicName" class="form-control" />
                </div>
                <div class="form-group mb-3">
                    <label asp-for="NewCompany.ComWebsite" class="form-label">الموقع الإلكتروني</label>
                    <input asp-for="NewCompany.ComWebsite" class="form-control" />
                </div>
                <div class="form-check mb-3">
                    <input asp-for="NewCompany.IsDefault" class="form-check-input" />
                    <label asp-for="NewCompany.IsDefault" class="form-check-label">افتراضي؟</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group mb-3">
                    <label asp-for="NewCompany.ComEnglishName" class="form-label">الاسم الإنجليزي</label>
                    <input asp-for="NewCompany.ComEnglishName" class="form-control" />
                </div>
                <div class="form-group mb-3">
                    <label asp-for="NewCompany.ShortEnglishName" class="form-label">الاسم المختصر إنجليزي</label>
                    <input asp-for="NewCompany.ShortEnglishName" class="form-control" />
                </div>
                <div class="form-group mb-3">
                    <label asp-for="NewCompany.ComAddress" class="form-label">العنوان</label>
                    <textarea asp-for="NewCompany.ComAddress" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group mb-3">
                    <label asp-for="NewCompany.ComNote" class="form-label">ملاحظات</label>
                    <textarea asp-for="NewCompany.ComNote" class="form-control" rows="3"></textarea>
                </div>
            </div>
        </div>
        <div class="text-center mt-4">
            <!-- استخدام onclick بدلاً من submit -->
            <button type="button" class="btn btn-submit px-4 py-2" onclick="submitCompanyForm()">حفظ</button>
        </div>
    </form>
</div>
<hr />

<div class="container form-container">
    <h2>قائمة الشركات</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>#</th>
                <th>الاسم العربي</th>
                <th>الاسم الإنجليزي</th>
                <th>مختصر عربي</th>
                <th>مختصر إنجليزي</th>
                <th>موقع</th>
                <th>عنوان</th>
                <th>ملاحظات</th>
                <th>افتراضي؟</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var c in Model.Companies)
            {
                <tr>
                    <td>@c.ComId</td>
                    <td>@c.ComArabicName</td>
                    <td>@c.ComEnglishName</td>
                    <td>@c.ShortArabicName</td>
                    <td>@c.ShortEnglishName</td>
                    <td>
                        @if (!string.IsNullOrEmpty(c.ComWebsite))
                        {
                            <a href="@c.ComWebsite" target="_blank">@c.ComWebsite</a>
                        }
                    </td>
                    <td>@c.ComAddress</td>
                    <td>@c.ComNote</td>
                    @* <td>@(c.IsDefault ? "نعم" : "لا")</td> *@
                    @* <td>@c.IsDefault.ToString().ToLower()</td> *@
                    <td>
  <input
    type="checkbox"
    class="icon-checkbox"
    disabled
    @(c.IsDefault ? "checked" : "")
  />
</td>


                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
       
        async function submitCompanyForm() {
            if (!validateCompany()) return;

            const form = document.getElementById("companyForm");
            const formData = new FormData(form);

            try {
                const res = await fetch(form.action, {
                    method: "POST",
                    body: formData
                });
                const json = await res.json();
                if (json.success) {
                    alert(json.message);
                    window.location.href = json.redirectUrl;
                } else {
                    alert("خطأ: " + json.message);
                }
            } catch (err) {
                console.error(err);
                alert("تعذر الاتصال بالخادم");
            }
        }

        function validateCompany() {
           const arabicName = document.getElementById("ComArabicName").value.trim();

            if (!arabicName) {
                alert("الرجاء إدخال الاسم العربي");
                return false;
            }
            console.log("النموذج جاهز للإرسال");
            return true;
        }
    </script>
}